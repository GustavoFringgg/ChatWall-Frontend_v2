import{r as d,j as P,c as n,d as c,a,t as B,F as g,p as b,s as N,i as S,f as h,o as i,h as T,y as U}from"./index-DiA7bTSl.js";import{P as V,u as x}from"./PostCard-Woi28hi2.js";import{u as z,N as D,_ as I}from"./NavbarCard-DvOawI6K.js";import{_ as F}from"./LoadingOverlay-CGQaiuOX.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const L={key:0},M={class:"container"},R={class:"row mt-4"},j={class:"col-lg-9"},E={class:"row"},O={class:"col text-center"},q={class:"fw-bold"},_="http://localhost:3000",X={__name:"CertainPostView",setup(G){const{formatTime:p}=x(),$=z(),{showAlert:l}=T(),u=S(),o=d(""),r=d([]),m=d(!0),y=U(),f=async()=>{const t=y.params.id,s=await h.get(`${_}/posts/${t}`,{headers:{Authorization:`Bearer ${o.value}`}});console.log("取的特定貼文的資料",s);try{r.value=s.data.message.map(e=>{const C=p(e.createdAt);return e.comments=e.comments.map(v=>{const A=p(v.createdAt);return{...v,formattedCommentDate:A}}),{...e,formattedDate:C}}),console.log("    getUserPost.value",r.value)}catch(e){console.error(e),l(`${e}`,"error")}},w=async()=>{o.value=document.cookie.replace(/(?:(?:^|.*;\s*)Token\s*\=\s*([^;]*).*$)|^.*$/,"$1"),o.value||(l("請登入","error"),u.push({path:"/login"}));try{const t=await h.get(`${_}/users/checkout`,{headers:{Authorization:`Bearer ${o.value}`}})}catch(t){l(`${t.response.data.message}`,"error"),u.push({path:"/"})}},k=async(t,s)=>{if(!s||!s.trim()){alert("請輸入留言！");return}try{const e=await h.post(`${_}/posts/${t}/comment`,{comment:s},{headers:{Authorization:`Bearer ${o.value}`}});f()}catch(e){console.error("留言失敗：",e)}};return P(async()=>{try{await w(),console.log("這是Index的onMounted"),$.loadUserInfo(),o.value?await f():u.push({path:"/"})}finally{m.value=!1}}),(t,s)=>(i(),n(g,null,[c(F,{"is-loading":m.value},null,8,["is-loading"]),m.value?N("",!0):(i(),n("div",L,[c(D),a("div",M,[a("div",R,[a("main",j,[a("div",E,[a("div",O,[a("h2",q,B(r.value[0].user.name)+"的文章",1)])]),(i(!0),n(g,null,b(r.value,e=>(i(),n("div",{class:"mb-3",key:e._id},[c(V,{post:e,onSubmitComment:k},null,8,["post"])]))),128))]),c(I)])])]))],64))}};export{X as default};
