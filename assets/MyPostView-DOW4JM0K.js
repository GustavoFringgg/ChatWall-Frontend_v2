import{r as _,i as x,c as d,d as m,a as t,u as p,b as A,v as $,F as k,p as B,y as M,E as N,o as i,g as S,h as V,A as U,B as T}from"./index-EPcCLbKF.js";import{P as E,u as F}from"./PostCard-Xeg990Gs.js";import{u as L,N as I,_ as O}from"./NavbarCard-DXiBNRcN.js";import{_ as R}from"./LoadingOverlay-Bj1r4_ZQ.js";import{u as j}from"./useDeletePost-CjzwQMGD.js";import"./dayjs.min-Wg1hCB3d.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const q={key:0},z={class:"container"},G={class:"row mt-4"},H={class:"col-lg-9"},J={key:0},K={key:1},Q={class:"d-flex mb-4"},W={class:"input-group border border-3 border-dark rounded-3"},re={__name:"MyPostView",setup(X){const y=S(),b=_(!0),{deletePost:C,getUserPost:l}=j(),{showAlert:c}=V(),{formatTime:v}=F(),u=L(),o=_(""),g=()=>{y.back()},f=async(a="desc")=>{const e=await N(a,o.value,u.userid,u.token);if(e.data.data.length===0&&o.value){c(`沒有找到關於${o.value}的貼文`,"warning",1500),o.value="";return}if(e.data.data.length===0){o.value="",l.value="";return}o.value&&(c(`找到關於${o.value}的${e.data.message.length}則貼文`,"success",1500),o.value="");try{l.value=e.data.message.map(s=>{const r=v(s.createdAt);return s.comments=s.comments.map(n=>{const D=v(n.createdAt);return{...n,formattedCommentDate:D}}),{...s,formattedDate:r}})}catch(s){c(`${s.response.message}`,"error")}},h=a=>{const e=a.target.value;f(e)},P=async(a,e)=>{if(!e||!e.trim())return c("請輸入留言~","error",1500);try{await U(a,e,u.token),w(a)}catch(s){console.error("留言失敗：",s)}},w=async a=>{try{const s=(await T(a,u.token)).message[0].comments.map(n=>({...n,formattedCommentDate:v(n.createdAt)})),r=l.value.findIndex(n=>n._id===a);r!==-1&&(l.value[r].comments=s)}catch(e){console.log("更新留言區域失敗:",e),c("留言更新失敗，請稍後再試","error",1500)}};return x(async()=>{try{u.loadUserInfo(),await f()}finally{b.value=!1}}),(a,e)=>{var s;return i(),d(k,null,[m(R,{"is-loading":b.value},null,8,["is-loading"]),b.value?M("",!0):(i(),d("div",q,[m(I),t("div",z,[t("div",G,[t("main",H,[(s=p(l))!=null&&s.length?(i(),d("div",K,[t("div",{class:"col text-center relative mb-3"},[t("button",{class:"btn btn-success rounded-3 mb-2 absolute",onClick:g},e[3]||(e[3]=[t("i",{class:"bi bi-arrow-left"},null,-1)])),e[4]||(e[4]=t("h2",{class:"fw-bold"},"您的貼文牆",-1))]),t("div",Q,[t("select",{class:"form-select w-auto me-2 border border-3 border-dark",onChange:h},e[5]||(e[5]=[t("option",{value:"desc"},"最新貼文",-1),t("option",{value:"asc"},"最舊貼文",-1),t("option",{value:"hot"},"熱門貼文",-1)]),32),t("div",W,[A(t("input",{type:"text",class:"form-control",placeholder:"搜尋貼文","onUpdate:modelValue":e[0]||(e[0]=r=>o.value=r)},null,512),[[$,o.value]]),t("button",{class:"btn btn-primary",onClick:f},e[6]||(e[6]=[t("i",{class:"bi bi-search"},null,-1)]))])]),(i(!0),d(k,null,B(p(l),r=>(i(),d("div",{class:"mb-3",key:r._id},[m(E,{post:r,onSubmitComment:P,onDeletePost:p(C)},null,8,["post","onDeletePost"])]))),128))])):(i(),d("div",J,[t("div",{class:"container p-0"},[t("button",{class:"btn btn-success rounded-3 mb-2",onClick:g},e[1]||(e[1]=[t("i",{class:"bi bi-arrow-left"},null,-1)]))]),e[2]||(e[2]=t("div",{class:"custom-card border border-3 border-dark"},[t("div",{class:"card-content"},"目前尚無動態，新增一則貼文吧！")],-1))]))]),m(O)])])]))],64)}}};export{re as default};
