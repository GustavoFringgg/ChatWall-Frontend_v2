import{r as f,i as b,c as m,d as i,a,t as A,F as p,p as D,y as N,B as h,o as l,g as B,J as S,h as V,A as x,N as M}from"./index-EPcCLbKF.js";import{P as T,u as U}from"./PostCard-Xeg990Gs.js";import{u as $,N as F,_ as L}from"./NavbarCard-DXiBNRcN.js";import{_ as O}from"./LoadingOverlay-Bj1r4_ZQ.js";import"./dayjs.min-Wg1hCB3d.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const R={key:0},E={class:"container"},I={class:"row mt-4"},J={class:"col-lg-9"},j={class:"row"},q={class:"col text-center"},z={class:"fw-bold"},Z={__name:"CertainPostView",setup(G){const y=B(),v=S(),d=f(!0),{showAlert:u}=V(),{formatTime:_}=U(),r=$(),n=f([]),g=async()=>{const s=v.params.id,e=await h(s,r.token);try{n.value=e.message.map(t=>{const c=_(t.createdAt);return t.comments=t.comments.map(o=>{const k=_(o.createdAt);return{...o,formattedCommentDate:k}}),{...t,formattedDate:c}})}catch(t){console.error(t),u(`${t}`,"error")}},C=async(s,e)=>{if(!e||!e.trim())return u("請輸入留言~","error",1500);try{await x(s,e,r.token),P(s)}catch(t){console.error("留言失敗：",t)}},P=async s=>{try{const t=(await h(s,r.token)).message[0].comments.map(o=>({...o,formattedCommentDate:_(o.createdAt)})),c=n.value.findIndex(o=>o._id===s);c!==-1&&(n.value[c].comments=t)}catch(e){console.log("更新留言區域失敗:",e),u("留言更新失敗，請稍後再試","error",1500)}},w=async s=>{try{await M(s,r.token),setTimeout(()=>{y.push({path:"/mylikelist"})},1500)}catch(e){console.log(e)}};return b(async()=>{try{r.loadUserInfo(),await g()}finally{d.value=!1}}),(s,e)=>(l(),m(p,null,[i(O,{"is-loading":d.value},null,8,["is-loading"]),d.value?N("",!0):(l(),m("div",R,[i(F),a("div",E,[a("div",I,[a("main",J,[a("div",j,[a("div",q,[a("h2",z,A(n.value[0].user.name)+"的文章",1)])]),(l(!0),m(p,null,D(n.value,t=>(l(),m("div",{class:"mb-3",key:t._id},[i(T,{post:t,onSubmitComment:C,onDeletePost:w},null,8,["post"])]))),128))]),i(L)])])]))],64))}};export{Z as default};
