import{r as l,j as F,c,d as _,a as s,t as $,u as I,s as A,b as O,v as L,F as B,p as M,i as R,y as j,f as m,o as i,h as E}from"./index-CVYQRrmA.js";import{_ as q}from"./LoadingOverlay-B5bDGRwL.js";import{u as G,N as H,_ as J}from"./NavbarCard-DT8qPjH1.js";import{P as K,u as Q}from"./PostCard-B1jPM5Gx.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";const X={key:0},Y={class:"container"},Z={class:"row mt-4"},ee={class:"col-lg-9"},se={class:"header-container mb-3 border border-3 border-dark rounded-3"},te={class:"user-info"},oe=["src"],ae={class:"username pe-2"},re={key:0,class:"user-followers"},ne={key:1,class:"user-followers"},le={key:0},ce={class:"d-flex mb-4"},ie={class:"input-group border border-3 border-dark rounded-3"},h="http://localhost:3000",ue={__name:"OtherPostView",setup(de){const b=R(),P=j(),w=l(!0),{showAlert:u}=E(),{formatTime:y}=Q(),r=G(),n=l(""),d=l(""),k=l([]),a=l(""),v=l(!1),p=l(0),f=P.params.id,x=async()=>{var t;try{const e=await m.get(`${h}/users/profile/${f}`,{headers:{Authorization:`Bearer ${n.value}`}});d.value=e.data,p.value=d.value.data.followers.length,v.value=(t=d.value.data)==null?void 0:t.followers.some(o=>o.user===r.userid)}catch(e){console.log("error",e)}},g=async(t="desc")=>{const e=await m.get(`${h}/posts/${f}/user`,{params:{timeSort:t,keyword:a.value},headers:{Authorization:`Bearer ${n.value}`}});if(console.log("res.data",e.data),e.data.message.length===0){u(`沒有找到關於${a.value}的貼文`,"warning",1500),a.value="";return}a.value&&(u(`找到關於${a.value}的${e.data.message.length}則貼文`,"success",1500),a.value="");try{k.value=e.data.message.map(o=>{const N=y(o.createdAt);return o.comments=o.comments.map(C=>{const T=y(C.createdAt);return{...C,formattedCommentDate:T}}),{...o,formattedDate:N}})}catch(o){u(`${o}`,"error")}},z=t=>{const e=t.target.value;g(e)},D=async()=>{n.value=document.cookie.replace(/(?:(?:^|.*;\s*)Token\s*\=\s*([^;]*).*$)|^.*$/,"$1"),n.value||(u("請登入","error"),b.push({path:"/"}));try{const t=await m.get(`${h}/users/checkout`,{headers:{Authorization:`Bearer ${n.value}`}})}catch(t){u(`${t.response.data.message}`,"error"),b.push({path:"/"})}},S=async(t,e)=>{if(!e||!e.trim()){alert("請輸入留言！");return}try{const o=await m.post(`${h}/posts/${t}/comment`,{comment:e},{headers:{Authorization:`Bearer ${n.value}`}});g()}catch(o){console.error("留言失敗：",o)}};F(async()=>{try{await D(),r.loadUserInfo(),n.value?(await g(),await x()):b.push({path:"/"})}finally{w.value=!1}});const U=()=>{history.back()},V=async()=>{v.value=!v.value;try{if(v.value){const t=await m.post(`${h}/users/${f}/follow`,{},{headers:{Authorization:`Bearer ${r.token}`}});p.value+=1,r.following.length+=1}else{console.log("here");const t=await m.delete(`${h}/users/${f}/unfollow`,{headers:{Authorization:`Bearer ${r.token}`}});console.log("res",t),p.value-=1,r.following.length-=1}}catch(t){u(`${t.response.data.message}`,"error",2e3)}};return(t,e)=>(i(),c(B,null,[_(q,{"is-loading":w.value},null,8,["is-loading"]),w.value?A("",!0):(i(),c("div",X,[_(H),s("div",Y,[s("div",Z,[s("main",ee,[s("button",{class:"btn btn-success rounded-3 mb-2",onClick:U},e[1]||(e[1]=[s("i",{class:"bi bi-arrow-left"},null,-1)])),s("div",se,[s("div",te,[s("img",{src:d.value.data.photo,alt:"Avatar",class:"rounded-circle me-2",style:{width:"50px",height:"50px"}},null,8,oe),s("span",ae,$(d.value.data.name),1),p.value===0?(i(),c("span",re,"目前還沒有人追蹤~~")):(i(),c("span",ne,$(p.value)+" 人追隨",1))]),d.value.data._id!==I(r).userid?(i(),c("div",le,[s("button",{class:"btn btn-warning rounded-pill",onClick:V},$(v.value?"已追隨":"追隨"),1)])):A("",!0)]),s("div",ce,[s("select",{class:"form-select w-auto me-2 border border-3 border-dark",onChange:z},e[2]||(e[2]=[s("option",{value:"desc"},"最新貼文",-1),s("option",{value:"asc"},"最舊貼文",-1),s("option",{value:"hot"},"熱門貼文",-1)]),32),s("div",ie,[O(s("input",{type:"text",class:"form-control",placeholder:"搜尋貼文","onUpdate:modelValue":e[0]||(e[0]=o=>a.value=o)},null,512),[[L,a.value]]),s("button",{class:"btn btn-primary",onClick:g},e[3]||(e[3]=[s("i",{class:"bi bi-search"},null,-1)]))])]),(i(!0),c(B,null,M(k.value,o=>(i(),c("div",{class:"mb-3",key:o._id},[_(K,{post:o,onSubmitComment:S},null,8,["post"])]))),128))]),_(J)])])]))],64))}},ge=W(ue,[["__scopeId","data-v-636542b0"]]);export{ge as default};
