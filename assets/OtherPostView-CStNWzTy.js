import{r as v,i as F,c,d as g,a as t,t as y,u as O,x as C,b as L,v as T,F as P,p as I,K as R,L as E,G,M as K,N as j,o as i,g as q,h as z,B as H,C as J,A as Q}from"./index-VyJHf4M5.js";import{_ as W}from"./LoadingOverlay-3h1urXEz.js";import{u as X,N as Y,_ as Z}from"./NavbarCard-BTq0AE6c.js";import{P as ee,u as te}from"./PostCard-Bf3LXMkW.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./dayjs.min-BInakxSv.js";const ae={key:0},oe={class:"container"},re={class:"row mt-4"},ne={class:"col-lg-9"},le={class:"header-container mb-3 border border-3 border-dark rounded-3"},ce={class:"user-info"},ie=["src"],de={class:"username pe-2"},ue={key:0,class:"user-followers"},me={key:1,class:"user-followers"},ve={key:0},fe={class:"d-flex mb-4"},_e={class:"input-group border border-3 border-dark rounded-3"},pe={__name:"OtherPostView",setup(ge){const D=q(),x=R(),h=v(!0),{showAlert:r}=z(),{formatTime:b}=te(),o=X(),d=v(""),u=v([]),l=v(""),f=v(!1),_=v(0),p=x.params.id,M=()=>{D.back()},$=async()=>{var s;try{const e=await E(p,o.token);d.value=e.data,_.value=d.value.data.followers.length,f.value=(s=d.value.data)==null?void 0:s.followers.some(a=>a.user===o.userid)}catch(e){console.log("error",e)}},w=async(s="desc")=>{var a;const e=await G(s,l.value,p,o.token);if(e.data.data.length===0){r(`沒有找到關於${l.value}的貼文`,"warning",1500),l.value="";return}l.value&&(r(`找到關於${l.value}的${e.data.message.length}則貼文`,"success",1500),l.value="");try{u.value=(a=e.data.message)==null?void 0:a.map(n=>{const m=b(n.createdAt);return n.comments=n.comments.map(k=>{const B=b(k.createdAt);return{...k,formattedCommentDate:B}}),{...n,formattedDate:m}})}catch(n){r(`${n.response.message}`,"error")}},A=s=>{const e=s.target.value;w(e)},N=async(s,e)=>{if(!e||!e.trim())return r("請輸入留言~","error",1500);try{await H(s,e,o.token),S(s)}catch(a){r(`${a.response.data.message}`,"error",1500)}},S=async s=>{try{const a=(await J(s,o.token)).message[0].comments.map(m=>({...m,formattedCommentDate:b(m.createdAt)})),n=u.value.findIndex(m=>m._id===s);n!==-1&&(u.value[n].comments=a)}catch(e){console.log("更新留言區域失敗:",e),r("留言更新失敗，請稍後再試","error",1500)}},U=async s=>{try{await Q(s,o.token),u.value=u.value.filter(e=>e._id!==s)}catch(e){r(`${e.response.data.message}`,"error",2e3)}},V=async()=>{f.value=!f.value;try{f.value?(await K(p,o.token),_.value+=1,o.following.length+=1,r("已追蹤~~","success",1500)):(await j(p,o.token),_.value-=1,o.following.length-=1,r("已取消追蹤~~","success",1500))}catch(s){r(`${s.response.data.message}`,"error",2e3)}};return F(async()=>{try{o.loadUserInfo(),await w(),await $()}finally{h.value=!1}}),(s,e)=>(i(),c(P,null,[g(W,{"is-loading":h.value},null,8,["is-loading"]),h.value?C("",!0):(i(),c("div",ae,[g(Y),t("div",oe,[t("div",re,[t("main",ne,[t("button",{class:"btn btn-success rounded-3 mb-2",onClick:M},e[1]||(e[1]=[t("i",{class:"bi bi-arrow-left"},null,-1)])),t("div",le,[t("div",ce,[t("img",{src:d.value.data.photo,alt:"Avatar",class:"rounded-circle me-2",style:{width:"50px",height:"50px"}},null,8,ie),t("span",de,y(d.value.data.name),1),_.value===0?(i(),c("span",ue,"目前還沒有人追蹤~~")):(i(),c("span",me,y(_.value)+" 人追隨",1))]),d.value.data._id!==O(o).userid?(i(),c("div",ve,[t("button",{class:"btn btn-warning rounded-pill",onClick:V},y(f.value?"已追隨":"追隨"),1)])):C("",!0)]),t("div",fe,[t("select",{class:"form-select w-auto me-2 border border-3 border-dark",onChange:A},e[2]||(e[2]=[t("option",{value:"desc"},"最新貼文",-1),t("option",{value:"asc"},"最舊貼文",-1),t("option",{value:"hot"},"熱門貼文",-1)]),32),t("div",_e,[L(t("input",{type:"text",class:"form-control",placeholder:"搜尋貼文","onUpdate:modelValue":e[0]||(e[0]=a=>l.value=a)},null,512),[[T,l.value]]),t("button",{class:"btn btn-primary",onClick:w},e[3]||(e[3]=[t("i",{class:"bi bi-search"},null,-1)]))])]),(i(!0),c(P,null,I(u.value,a=>(i(),c("div",{class:"mb-3",key:a._id},[g(ee,{post:a,onSubmitComment:N,onDeletePost:U},null,8,["post"])]))),128))]),g(Z)])])]))],64))}},Pe=se(pe,[["__scopeId","data-v-39881183"]]);export{Pe as default};
