import{r as p,K as R,L as J,h as U,i as K,c,d as b,a as t,t as D,u as n,y as M,b as j,v as q,F as S,p as z,J as G,M as H,E as Q,o as i,g as W,A as X,B as Y}from"./index-EPcCLbKF.js";import{_ as Z}from"./LoadingOverlay-Bj1r4_ZQ.js";import{u as V,N as ee,_ as te}from"./NavbarCard-DXiBNRcN.js";import{P as se,u as oe}from"./PostCard-Xeg990Gs.js";import{u as ae}from"./useDeletePost-CjzwQMGD.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./dayjs.min-Wg1hCB3d.js";const h=V(),{showAlert:F}=U();function ne(){const v=p(!1),g=p(0);return{toggleFollow:async u=>{v.value=!v.value;try{v.value?(await R(u,h.token),g.value+=1,h.following.length+=1,F("已追蹤~~","success",1500)):(await J(u,h.token),g.value-=1,h.following.length-=1,F("已取消追蹤~~","success",1500))}catch(w){F(`${w.response.data.message}`,"error",2e3)}},isFollowing:v,followersCount:g}}const le={key:0},ce={class:"container"},ie={class:"row mt-4"},ue={class:"col-lg-9"},de={class:"header-container mb-3 border border-3 border-dark rounded-3"},me={class:"user-info"},fe=["src"],ve={class:"username pe-2"},ge={key:0,class:"user-followers"},pe={key:1,class:"user-followers"},_e={key:0},be={class:"d-flex mb-4"},he={class:"input-group border border-3 border-dark rounded-3"},we={__name:"OtherPostView",setup(v){const g=W(),$=G(),u=p(!0),{toggleFollow:w,isFollowing:x,followersCount:y}=ne(),{showAlert:d}=U(),{formatTime:k}=oe(),{deletePost:B,getUserPost:_}=ae(),l=V(),m=p(""),r=p(""),C=$.params.id,N=()=>{g.back()},O=async()=>{var o;try{const e=await H(C,l.token);m.value=e.data,y.value=m.value.data.followers.length,x.value=(o=m.value.data)==null?void 0:o.followers.some(s=>s.user===l.userid)}catch(e){console.log("error",e)}},P=async(o="desc")=>{var s;const e=await Q(o,r.value,C,l.token);if(e.data.data.length===0){d(`沒有找到關於${r.value}的貼文`,"warning",1500),r.value="";return}r.value&&(d(`找到關於${r.value}的${e.data.message.length}則貼文`,"success",1500),r.value="");try{_.value=(s=e.data.message)==null?void 0:s.map(a=>{const f=k(a.createdAt);return a.comments=a.comments.map(A=>{const I=k(A.createdAt);return{...A,formattedCommentDate:I}}),{...a,formattedDate:f}})}catch(a){d(`${a.response.message}`,"error")}},T=o=>{const e=o.target.value;P(e)},L=async(o,e)=>{if(!e||!e.trim())return d("請輸入留言~","error",1500);try{await X(o,e,l.token),E(o)}catch(s){d(`${s.response.data.message}`,"error",1500)}},E=async o=>{try{const s=(await Y(o,l.token)).message[0].comments.map(f=>({...f,formattedCommentDate:k(f.createdAt)})),a=_.value.findIndex(f=>f._id===o);a!==-1&&(_.value[a].comments=s)}catch(e){console.log("更新留言區域失敗:",e),d("留言更新失敗，請稍後再試","error",1500)}};return K(async()=>{try{l.loadUserInfo(),await P(),await O()}finally{u.value=!1}}),(o,e)=>(i(),c(S,null,[b(Z,{"is-loading":u.value},null,8,["is-loading"]),u.value?M("",!0):(i(),c("div",le,[b(ee),t("div",ce,[t("div",ie,[t("main",ue,[t("button",{class:"btn btn-success rounded-3 mb-2",onClick:N},e[2]||(e[2]=[t("i",{class:"bi bi-arrow-left"},null,-1)])),t("div",de,[t("div",me,[t("img",{src:m.value.data.photo,alt:"Avatar",class:"rounded-circle me-2",style:{width:"50px",height:"50px"}},null,8,fe),t("span",ve,D(m.value.data.name),1),n(y)===0?(i(),c("span",ge,"目前還沒有人追蹤~~")):(i(),c("span",pe,D(n(y))+" 人追隨",1))]),m.value.data._id!==n(l).userid?(i(),c("div",_e,[t("button",{class:"btn btn-warning rounded-pill",onClick:e[0]||(e[0]=s=>n(w)(n(C)))},D(n(x)?"已追隨":"追隨"),1)])):M("",!0)]),t("div",be,[t("select",{class:"form-select w-auto me-2 border border-3 border-dark",onChange:T},e[3]||(e[3]=[t("option",{value:"desc"},"最新貼文",-1),t("option",{value:"asc"},"最舊貼文",-1),t("option",{value:"hot"},"熱門貼文",-1)]),32),t("div",he,[j(t("input",{type:"text",class:"form-control",placeholder:"搜尋貼文","onUpdate:modelValue":e[1]||(e[1]=s=>r.value=s)},null,512),[[q,r.value]]),t("button",{class:"btn btn-primary",onClick:P},e[4]||(e[4]=[t("i",{class:"bi bi-search"},null,-1)]))])]),(i(!0),c(S,null,z(n(_),s=>(i(),c("div",{class:"mb-3",key:s._id},[b(se,{post:s,onSubmitComment:L,onDeletePost:n(B)},null,8,["post","onDeletePost"])]))),128))]),b(te)])])]))],64))}},xe=re(we,[["__scopeId","data-v-1f5c01b0"]]);export{xe as default};
