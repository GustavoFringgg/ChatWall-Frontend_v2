import{r as l,c as d,d as u,a as e,b as y,v as w,s as C,F as x,f as p,o as m,h as I,i as U}from"./index-DiA7bTSl.js";import{u as B,N as F,_ as N}from"./NavbarCard-DvOawI6K.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const V={class:"container"},$={class:"row mt-4"},A={class:"col-lg-9"},D={class:"card border border-3 border-dark"},z={class:"card-body"},P={class:"mb-3"},T={class:"mb-3"},S={key:0,class:"mb-3 img-container border border-3 border-dark text-center"},E=["src"],v="http://localhost:3000",G={__name:"PostView",setup(M){const c=B(),{showAlert:o}=I(),f=U(),a=l(""),n=l(null),i=l(null),r=l(null),_=()=>{i.value.click()},b=s=>{const t=s.target.files[0];if(!t){alert("請選擇圖片！");return}n.value=t,h()},h=async()=>{if(!n.value){o("未選擇圖片！","error");return}const s=new FormData;s.append("file",n.value),s.append("type","post");try{const t=await p.post(`${v}/upload/file`,s,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${c.token}`}});r.value=t.data.fileUrl,o("圖片上傳成功","success")}catch(t){console.error("上傳失敗：",t),o("圖片上傳失敗！","error")}},g=async()=>{if(!a.value){o("請輸入貼文內容","error");return}const s={content:a.value,image:r.value};await p.post(`${v}/posts/`,s,{headers:{Authorization:`Bearer ${c.token}`}}),a.value="",r.value="",o("新增貼文成功，導回首頁","success"),setTimeout(()=>{f.push({path:"/index"})},1e3)};return(s,t)=>(m(),d(x,null,[u(F),e("div",V,[e("div",$,[e("main",A,[e("div",D,[t[2]||(t[2]=e("div",{class:"card-header text-center"},[e("h5",{class:"m-0"},"張貼動態")],-1)),e("div",z,[e("div",P,[t[1]||(t[1]=e("label",{for:"postContent",class:"form-label"},"貼文內容",-1)),y(e("textarea",{id:"postContent","onUpdate:modelValue":t[0]||(t[0]=k=>a.value=k),class:"form-control",cols:"10",rows:"10",style:{resize:"none"},placeholder:"輸入您的貼文內容"},null,512),[[w,a.value]])]),e("div",T,[e("div",null,[e("button",{class:"btn btn-primary",onClick:_},"上傳圖片"),e("input",{ref_key:"fileInput",ref:i,type:"file",class:"d-none",onChange:b},null,544)])]),r.value?(m(),d("div",S,[e("img",{src:r.value,alt:"Image Preview",class:"img-fluid-cos"},null,8,E)])):C("",!0),e("button",{class:"btn btn-success w-100",onClick:g},"送出貼文")])])]),u(N)])])],64))}};export{G as default};
