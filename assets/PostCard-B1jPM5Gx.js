import{d as $}from"./LoadingOverlay-B5bDGRwL.js";import{i as L,z as C,r as v,o,c as n,a as t,t as c,s as y,u as M,b as Y,v as j,q as E,F as H,p as U,S as V,f as D,h as F}from"./index-CVYQRrmA.js";import{u as I}from"./NavbarCard-DT8qPjH1.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";const vt=()=>({formatTime:g=>{const u=$(),d=$(g),a=u.diff(d,"second"),r=u.diff(d,"minute"),m=u.diff(d,"hour");return a<30?"剛剛新增":a<60?`${a}秒鐘前`:r<60?`${r} 分鐘前`:m<24?`${m} 小時前`:d.format("YYYY-MM-DD HH:mm")}}),N={class:"card border border-3 border-dark"},O={class:"card-body position-relative shadow-lg"},q={class:"d-flex align-items-center mb-3"},R=["src"],G={class:"text-muted"},J={key:0,style:{"white-space":"pre-wrap"}},Q={key:1,style:{"white-space":"pre-wrap"}},W={key:4,class:"mb-3 img-container border border-3 border-dark text-center"},X=["src"],Z={class:"d-flex align-items-center-3"},tt={key:0,class:"bi bi-hand-thumbs-up-fill me-2"},et={key:1,class:"bi bi-hand-thumbs-up text-secondary me-2"},st={key:2,class:"text-secondary"},ot={key:3},nt={class:"card-footer"},it={class:"mb-3 d-flex align-items-center"},lt=["src"],at={class:"list-group list-group-flush mt-3 comment-list-body gap-3"},rt={class:"d-flex align-items-center text-center me-2"},ct=["src"],dt={class:"text-muted mb-0",style:{"font-size":"12px"}},ut={class:"text-break mb-0"},S="http://localhost:3000",x=100,mt={__name:"PostCard",props:{post:Object},emits:["submit-comment","delete-post"],setup(e,{emit:g}){var w;const{showDeleteAlert:u}=F(),d=L(),a=I(),r=e,m=C(()=>r.post.user._id===a.userid),p=v(!1),P=C(()=>r.post.content.slice(0,x)+" ...."),A=()=>{p.value=!p.value},k=g,h=v(""),_=i=>{k("submit-comment",i,h.value),h.value=""},B=i=>{u().then(s=>{s.isConfirmed&&(k("delete-post",i),V.fire({title:"Deleted!",text:"此貼文已刪除",icon:"success"}))})},f=v((w=r.post.likes)==null?void 0:w.some(i=>i._id===a.userid)),b=v(r.post.likes.length),T=async()=>{try{if(f.value){const i=await D.delete(`${S}/posts/${r.post._id}/unlikes`,{headers:{Authorization:`Bearer ${a.token}`}});b.value-=1,f.value=!1}else await D.post(`${S}/posts/${r.post._id}/likes`,{},{headers:{Authorization:`Bearer ${a.token}`}}),b.value+=1,f.value=!0}catch(i){console.log("操作錯誤",i)}},z=i=>{d.push(`/otherpost/${i}`)};return(i,s)=>(o(),n("div",N,[t("div",O,[t("div",q,[t("img",{src:e.post.user.photo,alt:"Avatar",class:"rounded-circle me-2",style:{width:"50px",height:"50px"}},null,8,R),t("div",null,[t("h6",{onClick:s[0]||(s[0]=l=>z(e.post.user._id)),class:"m-0",style:{cursor:"pointer",color:"black"}},c(e.post.user.name),1),t("small",G,c(e.post.formattedDate),1)])]),e.post.content.length<x?(o(),n("p",J,c(e.post.content),1)):(o(),n("p",Q,c(p.value?e.post.content:P.value),1)),e.post.content.length>x?(o(),n("button",{key:2,type:"button",class:"btn btn-outline-primary btn-sm rounded-pill",onClick:A},c(p.value?"收起來":"閱讀更多"),1)):y("",!0),m.value?(o(),n("button",{key:3,onClick:s[1]||(s[1]=l=>B(e.post.id)),class:"btn btn-outline-secondary btn-sm position-absolute",style:{top:"10px",right:"10px"}},s[5]||(s[5]=[t("i",{class:"bi bi-x-lg"},null,-1)]))):y("",!0),e.post.image?(o(),n("div",W,[t("img",{src:e.post.image,alt:"Image Preview",class:"img-fluid-cos rounded"},null,8,X)])):y("",!0),t("div",Z,[t("button",{type:"button",class:"btn btn-link text-decoration-none",onClick:T},[f.value?(o(),n("i",tt)):(o(),n("i",et)),b.value?(o(),n("span",ot,c(b.value)+" 人",1)):(o(),n("span",st,"成為第一個按讚的人吧"))])]),t("div",nt,[t("div",it,[t("img",{src:M(a).photo,alt:"頭像",class:"rounded-circle me-2",style:{width:"40px",height:"40px","object-fit":"cover"}},null,8,lt),Y(t("input",{type:"text","onUpdate:modelValue":s[2]||(s[2]=l=>h.value=l),class:"form-control me-2",style:{flex:"1"},placeholder:"留言...",onKeyup:s[3]||(s[3]=E(l=>_(e.post._id),["enter"]))},null,544),[[j,h.value]]),t("button",{class:"btn btn-primary",onClick:s[4]||(s[4]=l=>_(e.post._id))},"留言")]),t("ul",at,[(o(!0),n(H,null,U(e.post.comments,l=>(o(),n("li",{key:l.id,class:"d-flex p-2 rounded-3",style:{"background-color":"#f8f6f4"}},[t("div",rt,[t("img",{src:l.user.photo,alt:"userphoto",style:{width:"35px",height:"35px"},class:"rounded-circle me-2"},null,8,ct)]),t("div",null,[t("strong",null,c(l.user.name),1),t("p",dt,c(l.formattedCommentDate),1),t("p",ut,c(l.comment),1)])]))),128))])])])]))}},gt=K(mt,[["__scopeId","data-v-b71c9859"]]);export{gt as P,vt as u};
