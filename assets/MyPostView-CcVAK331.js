import{r as p,i as x,c,d as m,a as t,b as $,v as A,F as _,p as D,x as M,G as B,o as u,g as N,h as S,B as V,C as U,A as T}from"./index-VyJHf4M5.js";import{P as F,u as L}from"./PostCard-Bf3LXMkW.js";import{u as E,N as G,_ as O}from"./NavbarCard-BTq0AE6c.js";import{_ as R}from"./LoadingOverlay-3h1urXEz.js";import"./dayjs.min-BInakxSv.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const j={key:0},q={class:"container"},z={class:"row mt-4"},H={class:"col-lg-9"},I={key:0},J={key:1},K={class:"d-flex mb-4"},Q={class:"input-group border border-3 border-dark rounded-3"},ae={__name:"MyPostView",setup(W){const k=N(),v=p(!0),{showAlert:d}=S(),{formatTime:b}=L(),i=E(),o=p(""),n=p([]),g=()=>{k.back()},f=async(s="desc")=>{const e=await B(s,o.value,i.userid,i.token);if(e.data.data.length===0&&o.value){d(`沒有找到關於${o.value}的貼文`,"warning",1500),o.value="";return}if(e.data.data.length===0){o.value="",n.value="";return}o.value&&(d(`找到關於${o.value}的${e.data.message.length}則貼文`,"success",1500),o.value="");try{n.value=e.data.message.map(a=>{const r=b(a.createdAt);return a.comments=a.comments.map(l=>{const P=b(l.createdAt);return{...l,formattedCommentDate:P}}),{...a,formattedDate:r}})}catch(a){d(`${a.response.message}`,"error")}},y=s=>{const e=s.target.value;f(e)},C=async(s,e)=>{if(!e||!e.trim())return d("請輸入留言~","error",1500);try{await V(s,e,i.token),h(s)}catch(a){console.error("留言失敗：",a)}},h=async s=>{try{const a=(await U(s,i.token)).message[0].comments.map(l=>({...l,formattedCommentDate:b(l.createdAt)})),r=n.value.findIndex(l=>l._id===s);r!==-1&&(n.value[r].comments=a)}catch(e){console.log("更新留言區域失敗:",e),d("留言更新失敗，請稍後再試","error",1500)}},w=async s=>{try{await T(s,i.token),n.value=n.value.filter(e=>e._id!==s)}catch(e){d(`${e.response.data.message}`,"error",2e3)}};return x(async()=>{try{i.loadUserInfo(),await f()}finally{v.value=!1}}),(s,e)=>{var a;return u(),c(_,null,[m(R,{"is-loading":v.value},null,8,["is-loading"]),v.value?M("",!0):(u(),c("div",j,[m(G),t("div",q,[t("div",z,[t("main",H,[(a=n.value)!=null&&a.length?(u(),c("div",J,[t("div",{class:"col text-center relative mb-3"},[t("button",{class:"btn btn-success rounded-3 mb-2 absolute",onClick:g},e[3]||(e[3]=[t("i",{class:"bi bi-arrow-left"},null,-1)])),e[4]||(e[4]=t("h2",{class:"fw-bold"},"您的貼文牆",-1))]),t("div",K,[t("select",{class:"form-select w-auto me-2 border border-3 border-dark",onChange:y},e[5]||(e[5]=[t("option",{value:"desc"},"最新貼文",-1),t("option",{value:"asc"},"最舊貼文",-1),t("option",{value:"hot"},"熱門貼文",-1)]),32),t("div",Q,[$(t("input",{type:"text",class:"form-control",placeholder:"搜尋貼文","onUpdate:modelValue":e[0]||(e[0]=r=>o.value=r)},null,512),[[A,o.value]]),t("button",{class:"btn btn-primary",onClick:f},e[6]||(e[6]=[t("i",{class:"bi bi-search"},null,-1)]))])]),(u(!0),c(_,null,D(n.value,r=>(u(),c("div",{class:"mb-3",key:r._id},[m(F,{post:r,onSubmitComment:C,onDeletePost:w},null,8,["post"])]))),128))])):(u(),c("div",I,[t("div",{class:"container p-0"},[t("button",{class:"btn btn-success rounded-3 mb-2",onClick:g},e[1]||(e[1]=[t("i",{class:"bi bi-arrow-left"},null,-1)]))]),e[2]||(e[2]=t("div",{class:"custom-card border border-3 border-dark"},[t("div",{class:"card-content"},"目前尚無動態，新增一則貼文吧！")],-1))]))]),m(O)])])]))],64)}}};export{ae as default};
