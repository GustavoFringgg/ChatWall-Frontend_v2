import{r as i,w as A,c as m,a as s,d as y,t as B,u as f,y as M,b as d,v as p,G as k,n as D,H as F,k as h,I as T,C as E,o as b,g as N,h as $}from"./index-EPcCLbKF.js";import{u as j,N as S,_ as R}from"./NavbarCard-DXiBNRcN.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const z={class:"container"},G={class:"row mt-4"},H={class:"col-lg-9"},q={class:"mb-4"},J={class:"row justify-content-center"},K={class:"col-md-8 relative"},L={class:"col text-center"},O={class:"fw-bold"},Q={class:"nav nav-tabs",id:"myTab",role:"tablist"},W={key:0,class:"nav-item",role:"presentation"},X={class:"col-md-8 tab-content border border-top-0 p-4"},Y={class:"tab-pane fade show active",id:"nickname",role:"tabpanel","aria-labelledby":"nickname-tab"},Z={class:"text-center mb-4"},ee={class:"img-container",style:{height:"140px"}},se=["src"],te=["src"],ae={class:"mt-4"},oe={class:"mb-3"},le={class:"mb-3"},ne={class:"form-check form-check-inline"},re={class:"form-check form-check-inline"},ie=["disabled"],de={class:"tab-pane fade",id:"password",role:"tabpanel","aria-labelledby":"password-tab"},ce={class:"mb-3 relative"},ue={class:"mb-3"},me={class:"mb-3"},we={__name:"ProfileView",setup(pe){const v=N(),{showAlert:n}=$(),r=j(),u=i(null),c=i(!1),o=i({name:"",sex:"male"}),l=i({oldPassword:"",newPassword:"",confirmPassword:""}),_=()=>{v.back()};A(c,()=>{const t=document.getElementById("currentPassword"),e=document.getElementById("newPassword"),a=document.getElementById("confirmPassword");c.value?(t==null||t.setAttribute("type","text"),e==null||e.setAttribute("type","text"),a==null||a.setAttribute("type","text")):(t==null||t.setAttribute("type","password"),e==null||e.setAttribute("type","password"),a==null||a.setAttribute("type","password"))});const x=async()=>{if(l.value.newPassword!=l.value.confirmPassword)return n("確認密碼不符新密碼","error",2e3);try{await F(l.value,r.token),l.value.oldPassword="",l.value.newPassword="",n("更新密碼成功，兩秒後導回登入頁","success",2e3),h(()=>{setTimeout(()=>{v.push({path:"/"})},2e3)})}catch(t){const{message:e}=t.response.data,V={400:e,401:e}[t.response.status]||"發生未知錯誤";n(V,"error",2e3)}},P=async()=>{try{const{data:t}=await T(o.value,r.token);r.username=o.value.name,o.value.name="",o.value.sex="male",n(`${t.message}，兩秒後導回頁`,"success",2e3),h(()=>{setTimeout(()=>{v.push({path:"/index"})},2e3)})}catch(t){console.log("error:",t),n(`${t.message}`,"error")}},w=i(null),g=i(null),U=()=>{g.value.click()},I=t=>{const e=t.target.files[0];w.value=e,C()},C=async()=>{const t=new FormData;t.append("file",w.value),t.append("type","user");try{const e=await E(t,r.token);u.value=e.fileUrl,n("圖片上傳成功","success"),o.value.photo=u.value}catch(e){console.log("上傳失敗：",e),n(`${e.response.data.message}`,"error",2e3)}};return(t,e)=>(b(),m("div",null,[s("div",null,[y(S),s("div",z,[s("div",G,[s("main",H,[s("div",q,[s("div",J,[s("div",K,[s("button",{class:"btn btn-success rounded-3 mb-2 absolute",style:{left:"0"},onClick:_},e[7]||(e[7]=[s("i",{class:"bi bi-arrow-left"},null,-1)])),s("div",L,[s("h2",O,B(f(r).username)+"的個人資料",1)]),s("ul",Q,[e[9]||(e[9]=s("li",{class:"nav-item",role:"presentation"},[s("button",{class:"nav-link active",id:"nickname-tab","data-bs-toggle":"tab","data-bs-target":"#nickname",type:"button",role:"tab","aria-controls":"nickname","aria-selected":"true"}," 暱稱修改 ")],-1)),f(r).googleId?M("",!0):(b(),m("li",W,e[8]||(e[8]=[s("button",{class:"nav-link",id:"password-tab","data-bs-toggle":"tab","data-bs-target":"#password",type:"button",role:"tab","aria-controls":"password","aria-selected":"false"}," 重設密碼 ",-1)])))])]),s("div",X,[s("div",Y,[s("form",null,[s("div",Z,[s("div",ee,[u.value?(b(),m("img",{key:0,src:u.value,alt:"頭像",class:"rounded-circle img-fluid-cos",style:{width:"200px",height:"200px","object-fit":"cover"}},null,8,se)):(b(),m("img",{key:1,src:f(r).photo,alt:"頭像",class:"rounded-circle img-fluid-cos",style:{width:"120px",height:"120px","object-fit":"cover"}},null,8,te))]),s("div",ae,[s("button",{class:"btn btn-primary",onClick:U}," 上傳大頭照 "),s("input",{ref_key:"fileInput",ref:g,type:"file",class:"d-none",onChange:I},null,544)])]),s("div",oe,[e[10]||(e[10]=s("label",{for:"nickname",class:"form-label"},"暱稱",-1)),d(s("input",{type:"text",class:"form-control",id:"nickname",placeholder:"輸入暱稱","onUpdate:modelValue":e[0]||(e[0]=a=>o.value.name=a)},null,512),[[p,o.value.name]])]),s("div",le,[e[13]||(e[13]=s("label",{class:"form-label"},"性別",-1)),e[14]||(e[14]=s("br",null,null,-1)),s("div",ne,[d(s("input",{class:"form-check-input",type:"radio",name:"gender",id:"genderMale",value:"male","onUpdate:modelValue":e[1]||(e[1]=a=>o.value.sex=a)},null,512),[[k,o.value.sex]]),e[11]||(e[11]=s("label",{class:"form-check-label",for:"genderMale"},"男",-1))]),s("div",re,[d(s("input",{class:"form-check-input",type:"radio",name:"gender",id:"genderFemale",value:"female","onUpdate:modelValue":e[2]||(e[2]=a=>o.value.sex=a)},null,512),[[k,o.value.sex]]),e[12]||(e[12]=s("label",{class:"form-check-label",for:"genderFemale"},"女",-1))])]),s("button",{disabled:!o.value.name.trim(),type:"button",class:"btn btn-secondary w-100",onClick:P}," 送出資訊 ",8,ie)])]),s("div",de,[s("form",null,[s("div",ce,[s("i",{id:"registerToggleEye",class:D(c.value?" bi bi-eye-fill":" bi bi-eye-slash"),onClick:e[3]||(e[3]=a=>c.value=!c.value)},null,2),e[15]||(e[15]=s("label",{for:"currentPassword",class:"form-label"},"目前密碼",-1)),d(s("input",{type:"password",class:"form-control",id:"currentPassword",placeholder:"輸入目前密碼","onUpdate:modelValue":e[4]||(e[4]=a=>l.value.oldPassword=a)},null,512),[[p,l.value.oldPassword]])]),s("div",ue,[e[16]||(e[16]=s("label",{for:"newPassword",class:"form-label"},"新密碼",-1)),d(s("input",{type:"password",class:"form-control",id:"newPassword",placeholder:"輸入新密碼","onUpdate:modelValue":e[5]||(e[5]=a=>l.value.newPassword=a)},null,512),[[p,l.value.newPassword]])]),s("div",me,[e[17]||(e[17]=s("label",{for:"confirmPassword",class:"form-label"},"確認密碼",-1)),d(s("input",{type:"password",class:"form-control",id:"confirmPassword",placeholder:"再次輸入新密碼","onUpdate:modelValue":e[6]||(e[6]=a=>l.value.confirmPassword=a)},null,512),[[p,l.value.confirmPassword]])]),s("button",{type:"button",class:"btn btn-secondary w-100",onClick:x}," 送出資訊 ")])])])])])]),y(R)])])])]))}};export{we as default};
