import{r as m,j as x,c as l,d as v,a as t,b as N,v as T,F as _,p as U,s as V,i as z,f as p,o as c,h as D}from"./index-CVYQRrmA.js";import{P as M,u as F}from"./PostCard-B1jPM5Gx.js";import{u as w,N as I,_ as L}from"./NavbarCard-DT8qPjH1.js";import{_ as j}from"./LoadingOverlay-B5bDGRwL.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const E={key:0},R={class:"container"},q={class:"row mt-4"},G={class:"col-lg-9"},H={key:0},J={key:1},K={class:"d-flex mb-4"},O={class:"input-group border border-3 border-dark rounded-3"},b="http://localhost:3000",te={__name:"MyPostView",setup(Q){const{formatTime:f}=F(),k=w(),{showAlert:u}=D(),h=z(),r=m(""),s=m(""),i=m([]),g=m(!0),d=async(o="desc")=>{const e=await p.get(`${b}/posts/${k.userid}/user`,{params:{timeSort:o,keyword:s.value},headers:{Authorization:`Bearer ${r.value}`}});if(console.log("這是搜尋的valuesearchPost.value",s.value),console.log("這是搜尋的message.length",e.data),e.data.data.length===0&&s.value){u(`沒有找到關於${s.value}的貼文`,"warning",1500),s.value="";return}if(e.data.data.length===0){s.value="",i.value="";return}console.log("searchPost.value",s.value),s.value&&(u(`找到關於${s.value}的${e.data.message.length}則貼文`,"success",1500),s.value="");try{i.value=e.data.message.map(a=>{const n=f(a.createdAt);return a.comments=a.comments.map(y=>{const S=f(y.createdAt);return{...y,formattedCommentDate:S}}),{...a,formattedDate:n}}),console.log("沒有貼文的getUserPost.value",i.value)}catch(a){u(`${a}`,"error")}},C=o=>{const e=o.target.value;d(e)},P=async()=>{r.value=document.cookie.replace(/(?:(?:^|.*;\s*)Token\s*\=\s*([^;]*).*$)|^.*$/,"$1"),r.value||(u("請登入","error"),h.push({path:"/"}));try{const o=await p.get(`${b}/users/checkout`,{headers:{Authorization:`Bearer ${r.value}`}})}catch(o){u(`${o.response.data.message}`,"error"),h.push({path:"/"})}},A=async(o,e)=>{if(!e||!e.trim()){alert("請輸入留言！");return}try{const a=await p.post(`${b}/posts/${o}/comment`,{comment:e},{headers:{Authorization:`Bearer ${r.value}`}});d()}catch(a){console.error("留言失敗：",a)}},B=async o=>{try{const e=await p.delete(`${b}/posts/${o}/post`,{headers:{Authorization:`Bearer ${k.token}`}});console.log("傳回來的deletePost",e),d()}catch(e){console.log(e)}};x(async()=>{try{await P(),console.log("這是onMounted"),w().loadUserInfo(),r.value?await d():h.push({path:"/"})}finally{g.value=!1}});const $=()=>{history.back()};return(o,e)=>{var a;return c(),l(_,null,[v(j,{"is-loading":g.value},null,8,["is-loading"]),g.value?V("",!0):(c(),l("div",E,[v(I),t("div",R,[t("div",q,[t("main",G,[(a=i.value)!=null&&a.length?(c(),l("div",J,[t("div",{class:"col text-center relative mb-3"},[t("button",{class:"btn btn-success rounded-3 mb-2 absolute",onClick:$},e[3]||(e[3]=[t("i",{class:"bi bi-arrow-left"},null,-1)])),e[4]||(e[4]=t("h2",{class:"fw-bold"},"您的貼文牆",-1))]),t("div",K,[t("select",{class:"form-select w-auto me-2 border border-3 border-dark",onChange:C},e[5]||(e[5]=[t("option",{value:"desc"},"最新貼文",-1),t("option",{value:"asc"},"最舊貼文",-1),t("option",{value:"hot"},"熱門貼文",-1)]),32),t("div",O,[N(t("input",{type:"text",class:"form-control",placeholder:"搜尋貼文","onUpdate:modelValue":e[0]||(e[0]=n=>s.value=n)},null,512),[[T,s.value]]),t("button",{class:"btn btn-primary",onClick:d},e[6]||(e[6]=[t("i",{class:"bi bi-search"},null,-1)]))])]),(c(!0),l(_,null,U(i.value,n=>(c(),l("div",{class:"mb-3",key:n._id},[v(M,{post:n,onSubmitComment:A,onDeletePost:B},null,8,["post"])]))),128))])):(c(),l("div",H,[t("div",{class:"container p-0"},[t("button",{class:"btn btn-success rounded-3 mb-2",onClick:$},e[1]||(e[1]=[t("i",{class:"bi bi-arrow-left"},null,-1)]))]),e[2]||(e[2]=t("div",{class:"custom-card border border-3 border-dark"},[t("div",{class:"card-content"},"目前尚無動態，新增一則貼文吧！")],-1))]))]),v(L)])])]))],64)}}};export{te as default};
