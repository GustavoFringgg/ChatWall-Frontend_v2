import{r as i,w as C,c as b,a as e,d as g,t as I,u as k,b as d,v as p,x as _,n as V,f as v,o as f,i as F,h as T}from"./index-CVYQRrmA.js";import{u as D,N as E,_ as z}from"./NavbarCard-DT8qPjH1.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const M={class:"container"},N={class:"row mt-4"},S={class:"col-lg-9"},R={class:"mb-4"},j={class:"row justify-content-center"},q={class:"col-md-8 relative"},G={class:"col text-center"},H={class:"fw-bold"},J={class:"col-md-8 tab-content border border-top-0 p-4"},K={class:"tab-pane fade show active",id:"nickname",role:"tabpanel","aria-labelledby":"nickname-tab"},L={class:"text-center mb-4"},O={class:"img-container",style:{height:"140px"}},Q=["src"],W=["src"],X={class:"mt-4"},Y={class:"mb-3"},Z={class:"mb-3"},ee={class:"form-check form-check-inline"},se={class:"form-check form-check-inline"},te=["disabled"],ae={class:"tab-pane fade",id:"password",role:"tabpanel","aria-labelledby":"password-tab"},le={class:"mb-3 relative"},oe={class:"mb-3"},re={class:"mb-3"},w="http://localhost:3000",ue={__name:"ProfileView",setup(ne){const y=F(),n=D(),{showAlert:r}=T(),u=i(null),l=i({name:"",sex:"男"}),o=i({oldPassword:"",newPassword:"",confirmPassword:""}),x=async()=>{o.value.newPassword!=o.value.confirmPassword&&r("確認密碼不符新密碼","error",2e3);try{const t=await v.patch(`${w}/users/updatePassword`,o.value,{headers:{Authorization:`Bearer ${n.token}`}});o.value.oldPassword="",o.value.newPassword="",r("更新密碼成功，兩秒後導回登入頁","success",2e3),setTimeout(()=>{y.push({path:"/"})},2e3)}catch(t){if(t.response)switch(t.response.status){case 401:r("密碼輸入錯誤","error",2e3)}else r("無法連接到伺服器","error",2e3)}},P=async()=>{try{const t=await v.patch(`${w}/users/profile/`,l.value,{headers:{Authorization:`Bearer ${n.token}`}});n.username=l.value.name,l.value.name="",l.value.sex="男",r(`${t.data.message}，兩秒後導回頁`,"success",2e3),setTimeout(()=>{y.push({path:"/index"})},2e3)}catch(t){console.log("error:",t),r(`${t.message}`,"error")}},m=i(null),h=i(null),U=()=>{h.value.click()},A=t=>{const s=t.target.files[0];if(!s){alert("請選擇圖片！");return}m.value=s,B()},B=async()=>{if(!m.value){r("未選擇圖片！","error");return}const t=new FormData;t.append("file",m.value),t.append("type","user");try{const s=await v.post(`${w}/upload/file`,t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${n.token}`}});u.value=s.data.fileUrl,r("圖片上傳成功","success"),l.value.photo=u.value}catch(s){console.error("上傳失敗：",s),r("圖片上傳失敗！","error")}},c=i(!1),$=()=>{history.back()};return C(c,()=>{const t=document.getElementById("currentPassword"),s=document.getElementById("newPassword"),a=document.getElementById("confirmPassword");c.value?(t==null||t.setAttribute("type","text"),s==null||s.setAttribute("type","text"),a==null||a.setAttribute("type","text")):(t==null||t.setAttribute("type","password"),s==null||s.setAttribute("type","password"),a==null||a.setAttribute("type","password"))}),(t,s)=>(f(),b("div",null,[e("div",null,[g(E),e("div",M,[e("div",N,[e("main",S,[e("div",R,[e("div",j,[e("div",q,[e("button",{class:"btn btn-success rounded-3 mb-2 absolute",style:{left:"0"},onClick:$},s[7]||(s[7]=[e("i",{class:"bi bi-arrow-left"},null,-1)])),e("div",G,[e("h2",H,I(k(n).username)+"的個人資料",1)]),s[8]||(s[8]=e("ul",{class:"nav nav-tabs",id:"myTab",role:"tablist"},[e("li",{class:"nav-item",role:"presentation"},[e("button",{class:"nav-link active",id:"nickname-tab","data-bs-toggle":"tab","data-bs-target":"#nickname",type:"button",role:"tab","aria-controls":"nickname","aria-selected":"true"}," 暱稱修改 ")]),e("li",{class:"nav-item",role:"presentation"},[e("button",{class:"nav-link",id:"password-tab","data-bs-toggle":"tab","data-bs-target":"#password",type:"button",role:"tab","aria-controls":"password","aria-selected":"false"}," 重設密碼 ")])],-1))]),e("div",J,[e("div",K,[e("form",null,[e("div",L,[e("div",O,[u.value?(f(),b("img",{key:0,src:u.value,alt:"頭像",class:"rounded-circle img-fluid-cos",style:{width:"200px",height:"200px"}},null,8,Q)):(f(),b("img",{key:1,src:k(n).photo,alt:"頭像",class:"rounded-circle img-fluid-cos",style:{width:"120px",height:"120px"}},null,8,W))]),e("div",X,[e("button",{class:"btn btn-primary",onClick:U}," 上傳大頭照 "),e("input",{ref_key:"fileInput",ref:h,type:"file",class:"d-none",onChange:A},null,544)])]),e("div",Y,[s[9]||(s[9]=e("label",{for:"nickname",class:"form-label"},"暱稱",-1)),d(e("input",{type:"text",class:"form-control",id:"nickname",placeholder:"輸入暱稱","onUpdate:modelValue":s[0]||(s[0]=a=>l.value.name=a)},null,512),[[p,l.value.name]])]),e("div",Z,[s[12]||(s[12]=e("label",{class:"form-label"},"性別",-1)),s[13]||(s[13]=e("br",null,null,-1)),e("div",ee,[d(e("input",{class:"form-check-input",type:"radio",name:"gender",id:"genderMale",value:"male","onUpdate:modelValue":s[1]||(s[1]=a=>l.value.sex=a)},null,512),[[_,l.value.sex]]),s[10]||(s[10]=e("label",{class:"form-check-label",for:"genderMale"},"男",-1))]),e("div",se,[d(e("input",{class:"form-check-input",type:"radio",name:"gender",id:"genderFemale",value:"female","onUpdate:modelValue":s[2]||(s[2]=a=>l.value.sex=a)},null,512),[[_,l.value.sex]]),s[11]||(s[11]=e("label",{class:"form-check-label",for:"genderFemale"},"女",-1))])]),e("button",{disabled:!l.value.name.trim(),type:"button",class:"btn btn-secondary w-100",onClick:P}," 送出資訊 ",8,te)])]),e("div",ae,[e("form",null,[e("div",le,[e("i",{id:"registerToggleEye",class:V(c.value?" bi bi-eye-fill":" bi bi-eye-slash"),onClick:s[3]||(s[3]=a=>c.value=!c.value)},null,2),s[14]||(s[14]=e("label",{for:"currentPassword",class:"form-label"},"目前密碼",-1)),d(e("input",{type:"password",class:"form-control",id:"currentPassword",placeholder:"輸入目前密碼","onUpdate:modelValue":s[4]||(s[4]=a=>o.value.oldPassword=a)},null,512),[[p,o.value.oldPassword]])]),e("div",oe,[s[15]||(s[15]=e("label",{for:"newPassword",class:"form-label"},"新密碼",-1)),d(e("input",{type:"password",class:"form-control",id:"newPassword",placeholder:"輸入新密碼","onUpdate:modelValue":s[5]||(s[5]=a=>o.value.newPassword=a)},null,512),[[p,o.value.newPassword]])]),e("div",re,[s[16]||(s[16]=e("label",{for:"confirmPassword",class:"form-label"},"確認密碼",-1)),d(e("input",{type:"password",class:"form-control",id:"confirmPassword",placeholder:"再次輸入新密碼","onUpdate:modelValue":s[6]||(s[6]=a=>o.value.confirmPassword=a)},null,512),[[p,o.value.confirmPassword]])]),e("button",{type:"button",class:"btn btn-secondary w-100",onClick:x}," 送出資訊 ")])])])])])]),g(z)])])])]))}};export{ue as default};
