import{d as C}from"./dayjs.min-BInakxSv.js";import{g as j,S as D,r as v,o,c as n,a as t,t as c,x as y,u as L,b as U,v as V,q as Y,F as A,p as B,T as E,U as H,V as F,h as I}from"./index-VyJHf4M5.js";import{u as K}from"./NavbarCard-BTq0AE6c.js";import{_ as N}from"./_plugin-vue_export-helper-DlAUqK2U.js";const vt=()=>({formatTime:g=>{const u=C(),d=C(g),a=u.diff(d,"second"),r=u.diff(d,"minute"),m=u.diff(d,"hour");return a<30?"剛剛新增":a<60?`${a}秒鐘前`:r<60?`${r} 分鐘前`:m<24?`${m} 小時前`:d.format("YYYY-MM-DD HH:mm")}}),O={class:"card border border-3 border-dark"},q={class:"card-body position-relative shadow-lg"},z={class:"d-flex align-items-center mb-3"},R=["src"],G={class:"text-muted"},J={key:0,style:{"white-space":"pre-wrap"}},Q={key:1,style:{"white-space":"pre-wrap"}},W={key:4,class:"mb-3 img-container border border-3 border-dark text-center"},X=["src"],Z={class:"d-flex align-items-center-3"},tt={key:0,class:"bi bi-hand-thumbs-up-fill me-2"},et={key:1,class:"bi bi-hand-thumbs-up text-secondary me-2"},st={key:2,class:"text-secondary"},ot={key:3},nt={class:"card-footer"},it={class:"mb-3 d-flex align-items-center"},lt=["src"],at={class:"list-group list-group-flush mt-3 comment-list-body gap-3"},rt={class:"d-flex align-items-center text-center me-2"},ct=["src"],dt={class:"text-muted mb-0",style:{"font-size":"12px"}},ut={class:"text-break mb-0"},x=100,mt={__name:"PostCard",props:{post:Object},emits:["submit-comment","delete-post"],setup(e,{emit:g}){var w;const{showDeleteAlert:u}=I(),d=j(),a=K(),r=e,m=D(()=>r.post.user._id===a.userid),p=v(!1),P=D(()=>r.post.content.slice(0,x)+" ...."),$=()=>{p.value=!p.value},k=g,b=v(""),_=l=>{k("submit-comment",l,b.value),b.value=""},S=l=>{u().then(s=>{s.isConfirmed&&(k("delete-post",l),E.fire({title:"Deleted!",text:"此貼文已刪除",icon:"success"}))})},f=v((w=r.post.likes)==null?void 0:w.some(l=>l._id===a.userid)),h=v(r.post.likes.length),M=async()=>{try{f.value?(await H(r.post._id,a.token),h.value-=1,f.value=!1):(await F(r.post._id,a.token),h.value+=1,f.value=!0)}catch(l){console.log("操作錯誤",l)}},T=l=>{d.push(`/otherpost/${l}`)};return(l,s)=>(o(),n("div",O,[t("div",q,[t("div",z,[t("img",{src:e.post.user.photo,alt:"Avatar",class:"rounded-circle me-2",style:{width:"50px",height:"50px","object-fit":"cover"}},null,8,R),t("div",null,[t("h6",{onClick:s[0]||(s[0]=i=>T(e.post.user._id)),class:"m-0",style:{cursor:"pointer",color:"black"}},c(e.post.user.name),1),t("small",G,c(e.post.formattedDate),1)])]),e.post.content.length<x?(o(),n("p",J,c(e.post.content),1)):(o(),n("p",Q,c(p.value?e.post.content:P.value),1)),e.post.content.length>x?(o(),n("button",{key:2,type:"button",class:"btn btn-outline-primary btn-sm rounded-pill",onClick:$},c(p.value?"收起來":"閱讀更多"),1)):y("",!0),m.value?(o(),n("button",{key:3,onClick:s[1]||(s[1]=i=>S(e.post.id)),class:"btn btn-outline-secondary btn-sm position-absolute",style:{top:"10px",right:"10px"}},s[5]||(s[5]=[t("i",{class:"bi bi-x-lg"},null,-1)]))):y("",!0),e.post.image?(o(),n("div",W,[t("img",{src:e.post.image,alt:"Image Preview",class:"img-fluid-cos rounded"},null,8,X)])):y("",!0),t("div",Z,[t("button",{type:"button",class:"btn btn-link text-decoration-none",onClick:M},[f.value?(o(),n("i",tt)):(o(),n("i",et)),h.value?(o(),n("span",ot,c(h.value)+" 人",1)):(o(),n("span",st,"成為第一個按讚的人吧"))])]),t("div",nt,[t("div",it,[t("img",{src:L(a).photo,alt:"頭像",class:"rounded-circle me-2",style:{width:"40px",height:"40px","object-fit":"cover"}},null,8,lt),U(t("input",{type:"text","onUpdate:modelValue":s[2]||(s[2]=i=>b.value=i),class:"form-control me-2",style:{flex:"1"},placeholder:"留言...",onKeyup:s[3]||(s[3]=Y(i=>_(e.post._id),["enter"]))},null,544),[[V,b.value]]),t("button",{class:"btn btn-primary",onClick:s[4]||(s[4]=i=>_(e.post._id))},"留言")]),t("ul",at,[(o(!0),n(A,null,B(e.post.comments,i=>(o(),n("li",{key:i.id,class:"d-flex p-2 rounded-3",style:{"background-color":"#f8f6f4"}},[t("div",rt,[t("img",{src:i.user.photo,alt:"userphoto",style:{width:"35px",height:"35px","object-fit":"cover"},class:"rounded-circle me-2"},null,8,ct)]),t("div",null,[t("strong",null,c(i.user.name),1),t("p",dt,c(i.formattedCommentDate),1),t("p",ut,c(i.comment),1)])]))),128))])])])]))}},gt=N(mt,[["__scopeId","data-v-266ae9b1"]]);export{gt as P,vt as u};
